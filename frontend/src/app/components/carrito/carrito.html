<div class="carrito-wrapper">
  <div class="carrito-header">
    <div class="container">
      <a href="/productos" class="back-button">
        <i class="fas fa-arrow-left"></i> Seguir comprando
      </a>
      <h1 class="carrito-title"><i class="fas fa-shopping-cart"></i> Mi Carrito</h1>
      <div class="carrito-stats">
        <span class="items-count">{{carrito.length}} items</span>
        <span class="total-amount">Total: ${{total}}</span>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="carrito-layout">
      <div class="carrito-main">
        <div class="carrito-cuadro">
          
          <div *ngIf="carrito.length===0" class="carrito-vacio">
            <div class="empty-cart-icon"><i class="fas fa-shopping-cart"></i></div>
            <h2>Tu carrito está vacío</h2>
            <a href="/productos" class="cta-button">Ir a la tienda</a>
          </div>

          <div *ngFor="let item of carrito" class="carrito-item">
            <div class="item-image">
               <img src="https://via.placeholder.com/80" alt="Producto">
            </div>
            <div class="item-info">
              <h3>{{item.nombre}}</h3>
              <p>{{item.descripcion}}</p>
              <span class="item-price">${{item.precio}} c/u</span>
            </div>
            <div class="item-controls">
              <div class="quantity-selector">
                <button (click)="disminuirCantidad(item)" [disabled]="item.cantidad <= 1">-</button>
                <span>{{item.cantidad}}</span>
                <button (click)="aumentarCantidad(item)" [disabled]="item.cantidad >= item.stock">+</button>
              </div>
              <div class="item-subtotal">${{item.precio * item.cantidad}}</div>
            </div>
            <button class="eliminar-btn" (click)="eliminarProducto(item)"><i class="fas fa-trash"></i></button>
          </div>
        </div>

        <div *ngIf="mostrarPago" class="form-pago-container">
          <div class="form-pago">
            <div class="payment-header">
              <h2><i class="fas fa-credit-card"></i> Finalizar Compra</h2>
              <p>Selecciona tu método de pago</p>
            </div>
            
            <div class="payment-methods">
              <div class="method-tabs">
                <button class="method-tab" 
                        [class.active]="metodoPago === 'tarjeta'" 
                        (click)="seleccionarMetodo('tarjeta')">
                  <i class="fas fa-credit-card"></i> Tarjeta
                </button>
                <button class="method-tab" 
                        [class.active]="metodoPago === 'efectivo'" 
                        (click)="seleccionarMetodo('efectivo')">
                  <i class="fas fa-money-bill-wave"></i> Efectivo
                </button>
              </div>
              
              <div class="card-form" [style.display]="metodoPago === 'tarjeta' ? 'block' : 'none'">
                <div class="form-group">
                  <label>Datos de la tarjeta (Stripe)</label>
                  <div id="card-element" class="stripe-box"></div>
                </div>
                <div class="form-group">
                  <label>Nombre del titular</label>
                  <input type="text" placeholder="Nombre completo">
                </div>
              </div>

              <div class="cash-info" *ngIf="metodoPago === 'efectivo'">
                 <div class="alert-cash">
                   <i class="fas fa-info-circle"></i>
                   <div>
                     <strong>Pago contra entrega / Sucursal</strong>
                     <p>Al confirmar, se generará tu orden y <b>se descontarán los productos del inventario</b> inmediatamente para reservarlos.</p>
                   </div>
                 </div>
              </div>
            </div>
            
            <div class="payment-actions">
              <button class="confirm-btn" (click)="procesarPago()">
                <i class="fas" [class.fa-lock]="metodoPago==='tarjeta'" [class.fa-check]="metodoPago==='efectivo'"></i>
                {{ metodoPago === 'tarjeta' ? 'Pagar Ahora' : 'Confirmar Orden' }} 
                ${{total * 0.9 | number:'1.2-2'}}
              </button>
              <button class="cancel-btn" (click)="mostrarPago=false">Cancelar</button>
            </div>
          </div>
        </div>

      </div>

      <div *ngIf="carrito.length>0 && !mostrarPago" class="carrito-sidebar">
        <div class="sidebar-card">
          <h3>Resumen</h3>
          <div class="sidebar-total">
            <div class="total-line"><span>Subtotal:</span> <span>${{total}}</span></div>
            <div class="total-line discount"><span>Descuento:</span> <span>-${{total * 0.1 | number:'1.2-2'}}</span></div>
            <div class="total-line final"><span>Total:</span> <span>${{total * 0.9 | number:'1.2-2'}}</span></div>
          </div>
          <button class="pagar-btn" (click)="iniciarPago()">Proceder al Pago</button>
        </div>
      </div>
    </div>
  </div>
</div>